{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nvar _jsxFileName = \"/home/runner/workspace/mobile/src/context/AuthContext.tsx\",\n  _this = this;\nimport React, { createContext, useState, useEffect, useCallback } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { getQueryFn, apiRequest } from \"../api/queryClient\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport var AuthContext = createContext({\n  user: null,\n  isLoading: false,\n  error: null,\n  signIn: function () {\n    var _signIn = _asyncToGenerator(function* () {});\n    function signIn() {\n      return _signIn.apply(this, arguments);\n    }\n    return signIn;\n  }(),\n  signUp: function () {\n    var _signUp = _asyncToGenerator(function* () {});\n    function signUp() {\n      return _signUp.apply(this, arguments);\n    }\n    return signUp;\n  }(),\n  signOut: function () {\n    var _signOut = _asyncToGenerator(function* () {});\n    function signOut() {\n      return _signOut.apply(this, arguments);\n    }\n    return signOut;\n  }()\n});\nexport var AuthProvider = function AuthProvider(_ref) {\n  var children = _ref.children;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    error = _useState2[0],\n    setError = _useState2[1];\n  var queryClient = useQueryClient();\n  var _useQuery = useQuery({\n      queryKey: ['/api/user'],\n      queryFn: getQueryFn({\n        on401: 'returnNull'\n      })\n    }),\n    user = _useQuery.data,\n    isLoading = _useQuery.isLoading,\n    queryError = _useQuery.error;\n  useEffect(function () {\n    if (queryError) {\n      setError(queryError);\n    }\n  }, [queryError]);\n  var loginMutation = useMutation({\n    mutationFn: function () {\n      var _mutationFn = _asyncToGenerator(function* (credentials) {\n        var res = yield apiRequest('POST', '/api/login', credentials);\n        if (!res.ok) {\n          var _error = yield res.text();\n          throw new Error(_error || 'Failed to login');\n        }\n        return yield res.json();\n      });\n      function mutationFn(_x) {\n        return _mutationFn.apply(this, arguments);\n      }\n      return mutationFn;\n    }(),\n    onSuccess: function onSuccess(userData) {\n      queryClient.setQueryData(['/api/user'], userData);\n      setError(null);\n    },\n    onError: function onError(error) {\n      setError(error);\n    }\n  });\n  var registerMutation = useMutation({\n    mutationFn: function () {\n      var _mutationFn2 = _asyncToGenerator(function* (userData) {\n        var res = yield apiRequest('POST', '/api/register', userData);\n        if (!res.ok) {\n          var _error2 = yield res.text();\n          throw new Error(_error2 || 'Failed to register');\n        }\n        return yield res.json();\n      });\n      function mutationFn(_x2) {\n        return _mutationFn2.apply(this, arguments);\n      }\n      return mutationFn;\n    }(),\n    onSuccess: function onSuccess(userData) {\n      queryClient.setQueryData(['/api/user'], userData);\n      setError(null);\n    },\n    onError: function onError(error) {\n      setError(error);\n    }\n  });\n  var logoutMutation = useMutation({\n    mutationFn: function () {\n      var _mutationFn3 = _asyncToGenerator(function* () {\n        var res = yield apiRequest('POST', '/api/logout');\n        if (!res.ok) {\n          var _error3 = yield res.text();\n          throw new Error(_error3 || 'Failed to logout');\n        }\n      });\n      function mutationFn() {\n        return _mutationFn3.apply(this, arguments);\n      }\n      return mutationFn;\n    }(),\n    onSuccess: function onSuccess() {\n      queryClient.setQueryData(['/api/user'], null);\n      setError(null);\n    },\n    onError: function onError(error) {\n      setError(error);\n    }\n  });\n  var signIn = useCallback(function () {\n    var _ref2 = _asyncToGenerator(function* (credentials) {\n      yield loginMutation.mutateAsync(credentials);\n    });\n    return function (_x3) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [loginMutation]);\n  var signUp = useCallback(function () {\n    var _ref3 = _asyncToGenerator(function* (userData) {\n      yield registerMutation.mutateAsync(userData);\n    });\n    return function (_x4) {\n      return _ref3.apply(this, arguments);\n    };\n  }(), [registerMutation]);\n  var signOut = useCallback(_asyncToGenerator(function* () {\n    yield logoutMutation.mutateAsync();\n  }), [logoutMutation]);\n  var value = {\n    user: user != null ? user : null,\n    isLoading: isLoading,\n    error: error,\n    signIn: signIn,\n    signUp: signUp,\n    signOut: signOut\n  };\n  return _jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 134,\n    columnNumber: 5\n  }, _this);\n};","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","useQuery","useMutation","useQueryClient","getQueryFn","apiRequest","jsxDEV","_jsxDEV","AuthContext","user","isLoading","error","signIn","_signIn","_asyncToGenerator","apply","arguments","signUp","_signUp","signOut","_signOut","AuthProvider","_ref","children","_useState","_useState2","_slicedToArray","setError","queryClient","_useQuery","queryKey","queryFn","on401","data","queryError","loginMutation","mutationFn","_mutationFn","credentials","res","ok","text","Error","json","_x","onSuccess","userData","setQueryData","onError","registerMutation","_mutationFn2","_x2","logoutMutation","_mutationFn3","_ref2","mutateAsync","_x3","_ref3","_x4","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_this"],"sources":["/home/runner/workspace/mobile/src/context/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useState, useEffect, useCallback } from 'react';\nimport { User, InsertUserSchema } from '../shared/schema';\nimport { z } from 'zod';\n\ntype InsertUser = z.infer<typeof InsertUserSchema>;\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { getQueryFn, apiRequest } from '../api/queryClient';\n\ntype LoginData = Pick<InsertUser, 'username' | 'password'>;\n\ninterface AuthContextType {\n  user: User | null;\n  isLoading: boolean;\n  error: Error | null;\n  signIn: (data: LoginData) => Promise<void>;\n  signUp: (data: InsertUser) => Promise<void>;\n  signOut: () => Promise<void>;\n}\n\nexport const AuthContext = createContext<AuthContextType>({\n  user: null,\n  isLoading: false,\n  error: null,\n  signIn: async () => {},\n  signUp: async () => {},\n  signOut: async () => {},\n});\n\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\n  const [error, setError] = useState<Error | null>(null);\n  const queryClient = useQueryClient();\n\n  // Fetch the current user\n  const { \n    data: user, \n    isLoading,\n    error: queryError\n  } = useQuery<User | undefined, Error>({\n    queryKey: ['/api/user'],\n    queryFn: getQueryFn({ on401: 'returnNull' }),\n  });\n\n  // Update error state when query error changes\n  useEffect(() => {\n    if (queryError) {\n      setError(queryError);\n    }\n  }, [queryError]);\n\n  // Login mutation\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: LoginData) => {\n      const res = await apiRequest('POST', '/api/login', credentials);\n      \n      if (!res.ok) {\n        const error = await res.text();\n        throw new Error(error || 'Failed to login');\n      }\n      \n      return await res.json();\n    },\n    onSuccess: (userData: User) => {\n      queryClient.setQueryData(['/api/user'], userData);\n      setError(null);\n    },\n    onError: (error: Error) => {\n      setError(error);\n    },\n  });\n\n  // Register mutation\n  const registerMutation = useMutation({\n    mutationFn: async (userData: InsertUser) => {\n      const res = await apiRequest('POST', '/api/register', userData);\n      \n      if (!res.ok) {\n        const error = await res.text();\n        throw new Error(error || 'Failed to register');\n      }\n      \n      return await res.json();\n    },\n    onSuccess: (userData: User) => {\n      queryClient.setQueryData(['/api/user'], userData);\n      setError(null);\n    },\n    onError: (error: Error) => {\n      setError(error);\n    },\n  });\n\n  // Logout mutation\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest('POST', '/api/logout');\n      \n      if (!res.ok) {\n        const error = await res.text();\n        throw new Error(error || 'Failed to logout');\n      }\n    },\n    onSuccess: () => {\n      queryClient.setQueryData(['/api/user'], null);\n      setError(null);\n    },\n    onError: (error: Error) => {\n      setError(error);\n    },\n  });\n\n  // Auth methods\n  const signIn = useCallback(async (credentials: LoginData) => {\n    await loginMutation.mutateAsync(credentials);\n  }, [loginMutation]);\n\n  const signUp = useCallback(async (userData: InsertUser) => {\n    await registerMutation.mutateAsync(userData);\n  }, [registerMutation]);\n\n  const signOut = useCallback(async () => {\n    await logoutMutation.mutateAsync();\n  }, [logoutMutation]);\n\n  const value = {\n    user: user ?? null,\n    isLoading,\n    error,\n    signIn,\n    signUp,\n    signOut,\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}